Задачи по SQL.
1.	Какие способы соединений таблиц Вы знаете? В чём их особенности, преимущества и недостатки?
1)	Джоины. Есть следующие типы: left join-соединяет 2 таблицы, из левой (первой таблицы) берёт всё, а из правой (таблицы 2) только совпадения; right join-тоже самое, что и left, только все значения берутся уже из правой (2-ой таблицы), а из левой (1-ой) только совпадения, full join=left join+right join, cross join-декартово произведение: все строки из левой соединяются со всеми строками из правой, inner join-соединение только совпавших значений из 2 таблиц (будут выведены только те строки из левой таблицы, которые есть в правой). Преимущества-меньше времени требуется на выполнение запросов, простой способ. Недостатки-нет.
2)	Через FROM перечислить все необходимые таблицы через запятую, а в WHERE написать условия их соединения. Преимущества-нет. Недостатки-слишком громоздкий запрос, при соединении таблиц таким способом, тратится больше времени для обработки запроса.
2.	Сколько записей будет удалено из таблицы ниже в результате выполнения выражения: delete from table_name where age=null?
id	name	age
45898	Исаак Ньютон	85
1256	Чарльз Дарвин	null
255	Галилео Галилей	78
48	Карл Маркс	
 
Ответ: ничего не удалится. Причина-null работает только с оператором IS (is/is not).
 
3.	Укажите ошибки в запросах ниже:
a)      Вывод информации о суммарных остатках (sum_rur) на дату на счетах (acc) в разрезе валют (cur):
select dt, acc, cur, sum(sum_rur) from dynamic_acc where sum_rur>0 group by dt, acc, cur
В group by отсутствует  разрез валют (cur)
b)      Вывод суммы значений 405 счетов за 2 даты: последнюю имеющуюся в таблице и недельной давности относительно последней:
select dt, sum(sum_rur) as sumrur from dynamic_acc da 
where dt in (select max(dt), acc from dynamic_acc union select max(dt)-7 from dynamic_acc where dt is null) and da.acc not like ‘405%’ group by dt order by dt desc
В подзапросе в UNION есть ошибка-неравное количество столбцов (в 1 запросе их два, а во 2 только один). Условие фильтрации лишние-оно по итогу выведет нам даты с значениями NULL, а нам нужны конкретные данные. Если в таблице ВСЕГО 405 записей, то условие da.acc not like ‘405%’ не нужно. Если в acc данные типа integer, то с ними не целесообразно применять like.
 
4.	В таблице RSB.ORDERS содержатся сведения о покупках, она состоит из следующих столбцов:
•         Amnt – сумма покупки
•         Odate – Дата покупки
•         Cid – ID покупателя, совершившего покупку
•         Sid – ID продавца, совершившего продажу.
 Таблица RSB.CUSTOMERS содержит сведения о покупателях, она состоит из следующих столбцов:
•         Cid – ID покупателя
•         Cname – фамилия покупателя
•         Sid – ID продавца, прикрепленного к данному покупателю.
Составьте запрос ДВУМЯ способами ( ПОДЗАПРОС , WITH), который выводит общую стоимость заказов для тех продавцов, у которых эта сумма превышает стоимость самого крупного заказа в таблице.
I.	Select Sid, Total_sum from (Select Sid, sum(Amnt) as Total_sum, max(amnt) as max_value from rsb.orders group by Sid) as table_1 where Total_Sum>max_value
II.	With cte_1 as (Select max(amnt) as max_value from rsb.orders)
Select Sid, sum(Amnt) as total_sum from rsb.orders
Group by Sid
Having total_sum>(select max_value from cte_1)

5.	В таблице RSB.TRANSACTION содержатся сведения о транзакциях(тратах), которые совершают клиенты по своим  картам, она состоит из следующих столбцов:
 
•         Card – Номер карты
•         Id – ID типа карты
•         Id_client – ID клиента
•         Date – Дата покупки
•         Amnt – Сумма транзакции
•         Tr_type–  Тип транзакции ( Снятие / Покупка в магазине/ Перевод)
 
Таблица RSB.CLIENTS содержит сведения о клиентах(держателях карт), она состоит из следующих столбцов:
•         Id_client  – ID клиента
•         Cname – Фамилия клиента
•         Age – Возраст клиента
 
Таблица RSB.PRODUCTS  содержит сведения о продуктах(типах карт) , она состоит из следующих столбцов:
•         Id – ID типа карты
•         Name – Расшифровка типа карты ( Кредитная/Дебетовая/Подарочная)
 
Составьте запрос, который выводит :
•         Оборот (сумму всех транзакций)
•          Количество транзакций
•          Уникальное кол-во карт, совершивших хотя бы одну транзакцию
            за ИЮЛЬ 2022 года по кредитным картам, держателями которых являются клиенты в возрасте от 20 до 30 лет.

Select sum(rsb.transaction.Amnt) as total_amnt, count(rsb.transaction.Type) as total_trns, count (distinct rsb.transaction.Card) as unique_cards from rsb.transaction
Left join rsb.products on rsb.transaction.Id= rsb.products.Id
Left join rsb.clients on rsb.transaction.Id_client= rsb.clients.Id_client
Where (Date between ’01-07-2022’ and ’31-07-2022’) and (rsb.clients.Age between 20 and 30) and (rsb,products.Name=’Кредитная’)

ПРИМЕЧАНИЕ: Date может быть разных форматов. Прежде всего это касается времени. Если время присутствует, значит необходимо его учесть. То есть: between ’01-07-2022 00:00:00’ and ’31-07-2022 23:59:59’. Также, если Date хранится в формате YYYY-MM-DD, то мы будем указывать в условии такой же формат.
